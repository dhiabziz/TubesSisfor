<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Regular users can only see documents from their projects -->
    <record id="document_rule_user" model="ir.rule">
        <field name="name">User: Only Their Project Documents</field>
        <field name="model_id" ref="model_project_document"/>
        <field name="domain_force">
            ['|',
                ('project_id.user_id', '=', user.id),
                ('project_id.message_partner_ids', 'in', [user.partner_id.id])
            ]
        </field>
        <field name="groups" eval="[(4, ref('document_repository.group_document_viewer'))]"/>
    </record>

    <!-- Uploaders can see all documents but only edit their own -->
    <record id="document_rule_uploader" model="ir.rule">
        <field name="name">Uploader: Edit Only Their Documents</field>
        <field name="model_id" ref="model_project_document"/>
        <field name="domain_force">
            ['|',
                ('create_uid', '=', user.id),
                '!', ('create_uid', '!=', user.id)
            ]
        </field>
        <field name="groups" eval="[(4, ref('document_repository.group_document_uploader'))]"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>
</odoo>